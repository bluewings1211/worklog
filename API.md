# Worklog API 文件

本文件記錄了 Worklog 專案的所有後端 API 端點。

## 伺服器資訊

- **伺服器檔案**: `server.js`
- **預設埠號**: 3000
- **資料庫**: SQLite3 (`/data/worklog.db`)
- **CORS**: 已啟用

## API 端點總覽

### 📋 Todo 管理

#### 1. 獲取所有待辦事項
```
GET /api/todos
```
- **描述**: 獲取所有待辦事項
- **回應**: 待辦事項陣列，包含解析後的 license_keys JSON

#### 2. 新增待辦事項
```
POST /api/todos
```
- **描述**: 建立新的待辦事項
- **必要欄位**: `project_code`, `task_type`, `status`
- **可選欄位**: `description`
- **回應**: 已建立的待辦事項物件

#### 3. 更新待辦事項
```
PUT /api/todos/:id
```
- **描述**: 更新指定的待辦事項
- **參數**: `id` (待辦事項 ID)
- **請求內容**: `project_code`, `task_type`, `description`, `status`, `license_keys`
- **回應**: 已更新的待辦事項物件

#### 4. 刪除待辦事項
```
DELETE /api/todos/:id
```
- **描述**: 刪除指定的待辦事項
- **參數**: `id` (待辦事項 ID)
- **回應**: 成功確認

### ⏰ 工作時段管理

#### 5. 查詢工作時段
```
GET /api/sessions
```
- **描述**: 查詢工作時段
- **查詢參數**: `todo_id`, `from`, `to`, `active`
- **回應**: 工作時段物件陣列

#### 6. 刪除工作時段
```
DELETE /api/sessions/:session_id
```
- **描述**: 刪除指定的工作時段
- **參數**: `session_id`
- **回應**: 成功確認

#### 7. 編輯工作時段
```
PUT /api/sessions/:session_id
```
- **描述**: 編輯指定的工作時段
- **參數**: `session_id`
- **請求內容**: `start_time`, `end_time`
- **回應**: 已更新的工作時段物件

### 📁 專案代碼管理

#### 8. 獲取所有專案代碼
```
GET /api/project_codes
```
- **描述**: 獲取所有專案代碼
- **回應**: 專案代碼字串陣列

#### 9. 新增專案代碼
```
POST /api/project_codes
```
- **描述**: 新增專案代碼
- **必要欄位**: `code`
- **回應**: 成功確認

#### 10. 刪除專案代碼
```
DELETE /api/project_codes/:code
```
- **描述**: 刪除指定的專案代碼
- **參數**: `code`
- **回應**: 成功確認

### 🏷️ 任務類型管理

#### 11. 獲取所有任務類型
```
GET /api/task_types
```
- **描述**: 獲取所有任務類型
- **回應**: 任務類型字串陣列

#### 12. 新增任務類型
```
POST /api/task_types
```
- **描述**: 新增任務類型
- **必要欄位**: `type`
- **回應**: 成功確認

#### 13. 刪除任務類型
```
DELETE /api/task_types/:type
```
- **描述**: 刪除指定的任務類型
- **參數**: `type`
- **回應**: 成功確認

### 📊 工時統計

#### 14. 獲取今日工時統計
```
GET /api/summary/today
```
- **描述**: 獲取指定日期的工時統計
- **查詢參數**: `date` (可選，預設為今天)
- **回應**: 按待辦事項分組的工時統計陣列

### 🔗 連結管理

#### 15. 獲取所有連結
```
GET /api/links
```
- **描述**: 獲取所有儲存的連結
- **回應**: 連結物件陣列

#### 16. 新增連結
```
POST /api/links
```
- **描述**: 新增連結
- **必要欄位**: `name`, `url`
- **可選欄位**: `note`
- **回應**: 已建立的連結物件

#### 17. 刪除連結
```
DELETE /api/links/:id
```
- **描述**: 刪除指定的連結
- **參數**: `id` (連結 ID)
- **回應**: 成功確認

### 📁 靜態檔案服務

#### 18. 靜態檔案與 SPA 路由
```
GET /{*any}
```
- **描述**: 提供靜態 React 建置檔案與處理 SPA 路由
- **特殊處理**: 
  - 對於 `/api/*` 路徑回傳 404
  - 對於其他所有路徑回傳 `index.html`

## 資料庫架構

### 資料表

1. **todos** - 待辦事項
2. **work_sessions** - 工作時段
3. **project_codes** - 專案代碼
4. **task_types** - 任務類型
5. **links** - 連結

## 中介軟體

- Express JSON 解析器
- 請求記錄
- CORS 支援

## 錯誤處理

所有 API 端點都包含適當的錯誤處理，會在發生錯誤時回傳適當的 HTTP 狀態碼與錯誤訊息。